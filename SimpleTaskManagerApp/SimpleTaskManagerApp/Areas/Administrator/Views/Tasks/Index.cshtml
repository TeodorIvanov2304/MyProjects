@using SimpleTaskManagerApp.ViewModels.Administrator
@model IEnumerable<AdminTaskViewModel>

@{
	ViewData["Title"] = "Tasks";
}

<div class="p-4 mb-3 bg-dark text-white rounded shadow">
	<h2 class="mb-4">All Tasks</h2>

	<div class="table-responsive rounded shadow">
		<table class="table table-dark table-bordered table-hover table-striped align-middle mb-0">
			<thead class="table-active">
				<tr>
					<th>Title</th>
					<th>Description</th>
					<th>Status</th>
					<th>Created At</th>
					<th>Due Date</th>
					<th>Is Deleted</th>
					<th>CreatedByEmail</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var task in Model)
				{
					var collapseId = "edit-collapse-" + task.Id;

					<tr class="@(task.IsDeleted ? "deleted-row" : "")">
						<td>@task.Title</td>
						<td>@task.Description</td>
						<td>@task.Status</td>
						<td>@task.CreatedAt.ToString("g")</td>
						<td>@task.DueDate?.ToString("g")</td>
						<td>
							@if (task.IsDeleted)
							{
								<span class="badge bg-danger">Yes</span>
							}
							else
							{
								<span class="badge bg-success">No</span>
							}
						</td>
						<td>@task.CreatedByEmail</td>
						<td class="d-flex flex-wrap gap-1">
							<button class="btn btn-sm btn-outline-primary load-admin-edit-form" data-task-id="@task.Id" data-bs-toggle="collapse" data-bs-target="#@collapseId" style="width:90px;"> Edit</button>

							@if (!task.IsDeleted)
							{
								<form asp-action="SoftDelete" asp-route-id="@task.Id" method="post" onsubmit="return confirm('Are you sure you want to delete this task?');">
									@Html.AntiForgeryToken()
									<button class="btn btn-sm btn-outline-danger" type="submit" style="width:90px;">Delete</button>
								</form>
							}
							else
							{
								<form asp-action="Restore" asp-controller="Tasks" asp-area="Administrator" method="post">
									@Html.AntiForgeryToken()
									<input type="hidden" name="id" value="@task.Id" />
									<button class="btn btn-sm btn-outline-success" type="submit" style="width:90px;">Restore</button>
								</form>

								<form asp-action="DeletePermanently" asp-controller="Tasks" asp-area="Administrator" method="post" onsubmit="return confirm('Are you sure you want to permanently delete this task?');">
									@Html.AntiForgeryToken()
									<input type="hidden" name="id" value="@task.Id" />
									<button class="btn btn-sm btn-danger" type="submit" style="width:90px;">Delete</button>
								</form>
							}
						</td>
					</tr>
					<tr class="collapse" id="@collapseId">
						<td colspan="8" id="edit-container-@task.Id" class="bg-light text-dark p-3">
							<em>Loading edit form...</em>
						</td>
					</tr>

				}
			</tbody>
		</table>
	</div>

	<div class="text-center mt-4">
		<a asp-area="Administrator" asp-controller="Administrator" asp-action="Index" class="btn btn-outline-light">
			← Back to Dashboard
		</a>
	</div>
</div>
